<html lang="en">
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="refresh" content="3600">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.2.3/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Bai+Jamjuree:wght@500&amp;display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>รายงานคุณภาพอากาศ</title>
  <style>
    body {
      background-color: #FFFDFD;
      font-family: 'Bai Jamjuree', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }

    .container {
      text-align: center;
    }

    .fontsize1 {
      font-size: 5.5rem;
    }

    .fontsize2 {
      font-size: 8rem;
      font-weight: bold;
    }

    .fontsize3 {
      font-size: 4.5rem;
    }

    .font-color1 {
      color: #023256;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img height="46.75" width="159.75" alt="โลโก้โรงพยาบาล" src="https://www.tsm.go.th/wp-content/uploads/2021/01/Logo001-Copy-Copy-copy-1.png" class="mb-3">
      <h3><strong>รายงานสถานการณ์คุณภาพอากาศ</strong></h3>
      <h3 style="font-size: 15px;">โรงพยาบาลสมเด็จพระเจ้าตากสินมหาราช จ.ตาก</h3>
      <div id="date-time" style="font-size: 15px;">กำลังโหลด...</div>
    </header>
    <hr>
    <section>
      <div class="row rounded rounded-4 p-4 mb-4" id="pm-widget" style="background-color: rgb(253, 192, 78);">
        <div class="col-12 text-center">
          <img src="./aqi_icon/ic-face-yellow.svg" width="200" alt="yellow" id="aqi-image" class="bg-white rounded-circle p-3 mt-4 mb-3">
          <h2 id="pm-aqi" class="fontsize2">59</h2>
          <h2 class="fontsize3">AQI</h2>
          <h2 id="pm-title">คุณภาพอากาศปานกลาง</h2>
          <p id="pm-text" class="fs-5">[ประชาชนทั่วไป] สามารถทำกิจกรรมกลางแจ้งได้ตามปกติ</p>
        </div>
      </div>
      <div class="row text-center">
        <div class="col-12 font-color1">
          <div class="border rounded rounded-4">
            <h1 class="fontsize1 rounded-bottom rounded-4" style="background-color:#ebebeb;" id="pm-25">27</h1>
            <h2 class="fs-3">ค่า PM 2.5</h2>
            <h2 class="fs-5">(ไม่ควรเกิน 37.5 มคก./ลบม.)</h2>
          </div>
        </div>
      </div>
    </section>
  </div>
  <script>
    function updateDateTime() {
      const now = new Date();
      const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' };
      document.getElementById('date-time').textContent = now.toLocaleDateString('th-TH', options);
    }

    function calculateAQI(Ci) {
      let Cmax, Cmin, Imax, Imin;

      if (Ci >= 0 && Ci <= 15) {
        Cmin = 0;
        Cmax = 15;
        Imax = 25;
        Imin = 0;
      } else if (Ci > 15 && Ci <= 25) {
        Cmin = 15.1;
        Cmax = 25;
        Imax = 50;
        Imin = 26;
      } else if (Ci > 25 && Ci <= 37.5) {
        Cmin = 25.1;
        Cmax = 37.5;
        Imax = 100;
        Imin = 51;
      } else if (Ci > 37.5 && Ci <= 75) {
        Cmin = 37.6;
        Cmax = 75;
        Imax = 200;
        Imin = 101;
      } else if (Ci > 75) {
        Cmin = 75.1;
        Cmax = 500;
        Imax = 500;
        Imin = 201;
      } else {
        throw new Error("Invalid PM2.5 concentration value");
      }

      return Math.round(((Imax - Imin) / (Cmax - Cmin)) * (Ci - Cmin) + Imin);
    }

    function updateAQIData() {
      const apiURL = 'https://www.cmuccdc.org/api/ccdc/value/5030';
      const apiaqiKey = 'b059a926-63b8-4527-8ef6-17af89a3399a';
      const aqicity = 'Mae Sot';
      fetch(apiURL)
        .then(response => response.json())
        .then(data => {
          const aqi = calculateAQI(data.pm25);
          const rgbValue = data.th_color.split(",");
          
          document.getElementById('pm-aqi').textContent = `${aqi}`;
          document.getElementById('pm-25').textContent = `${data.pm25}`;
          document.getElementById('pm-title').textContent = `${data.th_title}`;
          document.getElementById('pm-text').textContent = `${data.th_caption}`;
          document.getElementById('pm-widget').style.backgroundColor = `rgb(${rgbValue[0]}, ${rgbValue[1]}, ${rgbValue[2]})`;

          const aqiImageElement = document.getElementById('aqi-image');
          if (aqi > 200) {
            aqiImageElement.src = './aqi_icon/ic-face-red.svg';
            aqiImageElement.alt = 'red';
          } else if (aqi > 100) {
            aqiImageElement.src = './aqi_icon/ic-face-orange.svg';
            aqiImageElement.alt = 'orange';
          } else if (aqi > 50) {
            aqiImageElement.src = './aqi_icon/ic-face-yellow.svg';
            aqiImageElement.alt = 'yellow';
          } else {
            aqiImageElement.src = './aqi_icon/ic-face-green.svg';
            aqiImageElement.alt = 'green';
          }
        })
        .catch(error => console.error('Error fetching AQI data:', error));
    }

    updateDateTime();
    setInterval(updateDateTime, 1000); // อัพเดตวันที่และเวลาทุก 1 วินาที
    updateAQIData();
    setInterval(updateAQIData, 60000); // อัพเดต AQI ทุก 60 วินาที
  </script>
</body>
</html>
